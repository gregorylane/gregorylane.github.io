diffs_treat2 <- data.frame(Difference = c(
round(as.numeric(pred_t_effects2[1,])-as.numeric(act_treat[1,]), digits=2),
paste0("(",round(sqrt(sd(outputs3$target, na.rm=T)^2 +sd(outputs$target, na.rm=T)^2 + 0.87^2),digits=2),")"),
round(as.numeric(pred_t_effects2[3,])-as.numeric(act_treat[3,]), digits=2),
paste0("(",round(sqrt(sd(outputs3$exp_profit, na.rm=T)^2 +sd(outputs$exp_profit, na.rm=T)^2 + 1.96^2),digits=2),")"),
round(as.numeric(pred_t_effects2[5,])-as.numeric(act_treat[5,]), digits=2),
paste0("(",round(sqrt(sd(outputs3$exp_salary, na.rm=T)^2 +sd(outputs$exp_salary, na.rm=T)^2 + 0.35^2),digits=2),")"),
round(as.numeric(pred_t_effects2[7,])-as.numeric(act_treat[7,]), digits=2),
paste0("(",round(sqrt(sd(outputs3$ep, na.rm=T)^2 +sd(outputs$ep, na.rm=T)^2 + 0.01^2),digits=2),")"),
"---","",
"---","",
"---",""
))
#Bind Tables
temp<- as.data.frame(table[,1])
names(temp) <- "Outcome"
out_table2 <- bind_cols(temp, pred_t_effects, act_treat, diffs_treat)
out_table3 <- bind_cols(temp, pred_t_effects2, act_treat, diffs_treat2)
tbl2<- print.xtable(xtable(out_table2,
caption=c("Predicted Treatment Effects Versus Observed Treatment Effects"),
align=c("l","p{9cm}","c", "c", "c")),
include.rownames=FALSE,
caption.placement = getOption("xtable.caption.placement", "top"),
latex.environments = getOption("xtable.latex.environments", c("center")),
hline.after=c(-1,-1,0,nrow(table),nrow(table)),
add.to.row=list(pos=list(2,4,6,8,10,12), command=c("[.5em]","[.5em]","[.5em]","[.5em]","[.5em]","[.5em]"))
)
#cat(tbl2, sep = '\n', file="~/Dropbox/Matatu/model/greg/sims/tables/compare_table2.tex")
cat(tbl2, sep = '\n', file="~/Dropbox/Matatu/tables/compare_table2.tex")
print(xtable(out_table2), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/compare_table2_b.tex")
tbl3<- print.xtable(xtable(out_table3,
caption=c("Predicted Treatment Effects Versus Observed Treatment Effects"),
align=c("l","p{9cm}","c", "c", "c")),
include.rownames=FALSE,
caption.placement = getOption("xtable.caption.placement", "top"),
latex.environments = getOption("xtable.latex.environments", c("center")),
hline.after=c(-1,-1,0,nrow(table),nrow(table)),
add.to.row=list(pos=list(2,4,6,8,10,12), command=c("[.5em]","[.5em]","[.5em]","[.5em]","[.5em]","[.5em]"))
)
cat(tbl3, sep = '\n', file="~/Dropbox/Matatu/tables/replication/compare_table3.tex")
print(xtable(out_table3), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table3_b.tex")
#### Write combined table ####
fixed1 <- data.frame(`Input`= c("Repair Costs",
"",
"Revenue Distribution",
"",
"Discount Factor",
""
),
`Symbol` = c("$E[c(r)]$",
"",
"$G(\\cdot)$",
"",
"$\\delta$",
""
),
`Value` = c("4.9",
"",
"---",
"",
"0.99",
""
),
`Justification` = c("Average repair costs seen in the control group",
"",
"Empirical distribution calculated from control group data ",
"",
"",
""
)
)
calibration1 <- data.frame(`Input`= c( "Disutility",
"",
"Firing Cost",
"",
"Outside Option",
""
),
`Symbol` = c("$\\psi(e^*, r^*)$",
"",
"$h$",
"",
"$\\bar u$",
""),
`Value` = c(
"4.99   (0.01)",
"",
"51.44   (0.50)",
"",
"7.07   (0.04)",
""),
`Interpretation` = c(
"Disutility equivalent to 5 dollars",
"",
"Total firing costs equivalent to 51 days lost profits",
"",
"Approximately the average un-skilled daily wage",
"")
)
# Code to get just table contents (write formatting directly in latex)
print(xtable(fixed1), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table1_a.tex")
print(xtable(calibration1), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table1_2a.tex")
#Table for treatment effects - target match
fixed2 <- data.frame(`Input`= c("Repair Costs",
"",
"Revenue Distribution",
"",
"Discount Factor",
"",
"Firing Cost",
"",
"Outside Option",
""),
`Symbol` = c("$E[c(r)]$",
"",
"$G(\\cdot)$",
"",
"$\\delta$",
"",
"$h$",
"",
"$\\bar u$",
""),
`Value` = c("2.7",
"",
"---",
"",
"0.99",
"",
"51.44",
"",
"7.07",
""),
`Justification` = c("Previous value of 4.9 minus observed treatment effect reduction of 2.2",
"",
"Empirical distribution calculated from treatment group data",
"",
"",
"",
"Fixed from previous value",
"",
"Fixed from previous value",
"")
)
calibration2 <- data.frame(`Input`= c( "Disutility",
""),
`Symbol` = c("$\\psi(e^*, r^*)$",
""),
`Value` = c("6.08",
"(0.07)"),
`Interpretation` = c("Increase of 1.09 (22\\%) from previous value",
"")
)
print(xtable(fixed2), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table2_a.tex")
print(xtable(calibration2), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table2_2a.tex")
#Table for treatment effects - all match
fixed3 <- data.frame(`Input`= c("Repair Costs",
"",
"Revenue Distribution",
"",
"Discount Factor",
"",
"Firing Cost",
"",
"Outside Option",
""),
`Symbol` = c("$E[c(r)]$",
"",
"$G(\\cdot)$",
"",
"$\\delta$",
"",
"$h$",
"",
"$\\bar u$",
""),
`Value` = c("2.7",
"",
"---",
"",
"0.99",
"",
"51.44",
"",
"7.07",
""),
`Justification` = c("Previous value of 4.9 minus observed treatment effect reduction of 2.2",
"",
"Empirical distribution calculated from data",
"",
"",
"",
"Fixed from previous value",
"",
"Fixed from previous value",
"")
)
calibration3 <- data.frame(`Input`= c( "Disutility",
""),
`Symbol` = c("$\\psi(e^*, r^*)$",
""),
`Value` = c("4.53",
"(0.03)"),
`Interpretation` = c("Decrease of 0.46 (9\\%) from previous value",
"")
)
print(xtable(fixed3), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table3_a.tex")
print(xtable(calibration3), include.rownames=FALSE, only.contents=T, sanitize.text.function= identity, file="~/Dropbox/Matatu/tables/replication/compare_table3_2a.tex")
#V_5 update: tried to improve on V and U formula to make trade-off, re-calibrated outside option relative to subsistence
#V_7 update: changed U to new formula
rm(list = ls())
options(stringsAsFactors=FALSE)
library(pacman)
p_load(data.table, tidyverse, magrittr, ggplot2, FixedPoint, fitdistrplus, stats, boot, gmm,
stargazer, xtable, lfe, huxtable, dfoptim)
set.seed(123456)
#Using real surplus data
surplus <- read.csv("~/Dropbox/Matatu/model/greg/sims/surplus2.csv") %>%
mutate(surplus = ifelse(surplus < 0, NA, surplus)) %>%
mutate(surplus = ifelse(surplus < 10 & surplus>0, surplus*100, surplus)) %>%
mutate(surplus = surplus/100-7)%>% #subtract off the subsistence constraint
na.omit
#Quick look at the different surplus distributions
#ggplot() + geom_histogram(data=surplus %>% filter(treat==1), aes(x=surplus, color="treat"), alpha=0.4) +
#  geom_histogram(data=surplus %>% filter(treat==0), aes(x=surplus, color="control"), alpha=0.4)
#Write function that optimizes T and finds fixed point
boot_opt <- function(x, treat) {
if(treat==1) {
surplus %<>% filter(treat==1)
}
if(treat==0) {
surplus %<>% filter(treat==0)
}
surplus <- as.data.frame(surplus$surplus)
sample <- sample_n(surplus, size=9504, replace=T)
#fit theoretical distribution to data
fg <- fitdist(sample$surplus, distr="logis")
#grab distribution paramters
mean <- as.numeric(fg$estimate[1]) #pull mean from estimated distribution
std <- as.numeric(fg$estimate[2]) #pul std from estimated distribution
#function to calc proportion lost income
lost_inc <- function(i) {
t <- 1:i
func <- function(x) {
val <- 10*0.99^(x-1)
}
vals <- lapply(t, func)
value <- 10 + sum(as.vector(unlist(vals)))
prop <- (10 + value)/(10/(1-0.99))
}
p <- lost_inc(days_lost)
#Starting choice of target and value of contract for fixed point algorithm
g_u <- 500 #need some fixed value of U for input in recursive problem
max_target = delta*g_u #calc max_target possible given the first guess of U
g_target <- min(30, max_target) #choose target, but don't allow choice above max transfer compatible T or algorithm breaks
g_v <- 400 #need some first guess fo V
g_welfare <- g_u + g_v
#welfare calculator using initial choice of the target, initial U choice and primitives (fixed point will run until input T = output T)
output <- function(inputs){
target <-inputs[1]
u_fix <-inputs[3]
v_fix <- inputs[4]
h <-p*v_fix
alpha <- (target - mean)/std #how many std. devs the target is above / below mean
intercept <- max(1 - (target)/(delta*u_fix),0) # define p_0
#Calc expected value of y above and below target
exp_y_below <- mean(surplus$surplus[surplus <= target], na.rm=T)
exp_y_above <- mean(surplus$surplus[surplus >= target], na.rm=T)
#Formula of expected continutation probability
continue_prob = plogis(target, mean, std)*(intercept + (1/(delta*u_fix))*exp_y_below)+(1-plogis(target, mean, std))
#U <- ((1-plogis(target, mean, std))*(exp_y_above - target)-work_cost+
#        (1 - continue_prob)*delta*outside_option*(1-delta))/(1-delta) - outside_option #multipy outside option by 1-delta to get it back to daily payoff
#new version of U
U <- (mean(surplus$surplus) - target - work_cost +
(1 - continue_prob)*delta*outside_option*(1-delta)) / (1-delta) - outside_option
#Re-Calc max target possible to limit search function
max_target2 = delta*U
V <-  (target - plogis(target, mean, std)*(1+(v_fix/U))*(target - exp_y_below) - exp_cost -
(1 - continue_prob)*delta*(v_fix-h))/(1 - delta) #Calc Value of contract for owner
#find target that maximizes the owner payoff given all the above
xmin <- qlogis(0.1, mean, std) #Note, for some parameter values, too low a target search leads to NAs which breaks system, change this if optim fails
xmax <- qlogis(0.7, mean, std)
own_payoff <- function(target, u) {
payoff <- delta*V + target - exp_cost - plogis(target, mean, std)*(1+h/U)*(target - exp_y_below)
#payoff <- delta*V + target - exp_cost - plogis(target, mean, std)*(1+h/U)*target + plogis(target, mean, std)*exp_y_below*(h/U)
}
output <- optimize(own_payoff, interval=c(xmin, xmax), maximum=TRUE, u=U)
tar <- output$maximum
#Calculate owner payoff, driver payoff, and calc max target that driver will agree to (i.e. see if optimal owner target is outside of participation constraint)
own_payoff <- output$objective
dri_payoff <- delta*U - tar + mean - work_cost
min_agree_tar <- delta*U -dri_payoff + mean - work_cost
#Recalc target and payoffs now that see if at boundry
tar = min(tar, min_agree_tar)
own_payoff <- delta*V + tar - exp_cost - plogis(tar, mean, std)*(1+V/U)*(tar - exp_y_below)
profits <- tar - exp_cost - plogis(tar, mean, std)*(tar - exp_y_below)
exp_salary <- (1-plogis(target, mean, std))*(exp_y_above-target) + 7 #add back subsistence constraint
exp_income <- tar - plogis(tar, mean, std)*(tar - exp_y_below)
welfare <- U + V
return(c(tar, max_target2, U, V, continue_prob, profits, intercept, exp_salary, exp_income, welfare))
}
inputs <- c(g_target, 40, g_u, g_v, 0.9, 10, 0.9, 8, 10, g_welfare) #Give inputs for target, max target, Driver U, owner_payoff,  driver_payoff, and continue prob
values <- FixedPoint(Function = output, Inputs = inputs, Method = "Anderson", MaxIter = 10000)
end_target <- values$FixedPoint[1]
max_target_chosen <- round(values$FixedPoint[1],0.1) == round(values$FixedPoint[2], 0.1)
end_U <- values$FixedPoint[3]
end_V <- values$FixedPoint[4]
end_ep <- values$FixedPoint[5]
end_exp_profits <- values$FixedPoint[6]
end_intercept <- values$FixedPoint[7]
end_exp_salary <- values$FixedPoint[8]
end_exp_income <- values$FixedPoint[9]
end_welfare <- values$FixedPoint[10]
results <- c(end_target, end_U, end_V, end_ep, end_exp_profits, end_intercept, end_exp_salary, end_exp_income, end_welfare)
return(results)
}
#function to calc proportion lost income
lost_inc <- function(i) {
t <- 1:i
func <- function(x) {
val <- 10*0.99^(x-1)
}
vals <- lapply(t, func)
value <- 10 + sum(as.vector(unlist(vals)))
prop <- (10 + value)/(10/(1-0.99))
}
#Choose parameters
exp_cost <- 4.9 # in data average is 4.9 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.999 #discount factor
work_cost <- 4.998 #  cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
#Bootstrap results
set.seed(123456)
outputs <- as.data.frame(t(sapply(1:200, boot_opt, treat=0)) )
names(outputs) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income",  "welfare")
results<-data.frame(estimate=c(mean(outputs$target, na.rm=T), mean(outputs$U, na.rm=T), mean(outputs$V, na.rm=T), mean(outputs$ep, na.rm=T), mean(outputs$exp_profit, na.rm=T), mean(outputs$exp_salary, na.rm=T), mean(outputs$welfare, na.rm=T)),
stderr = c(sd(outputs$target, na.rm=T),sd(outputs$U, na.rm=T), sd(outputs$V, na.rm=T), sd(outputs$ep, na.rm=T), sd(outputs$exp_profit, na.rm=T), sd(outputs$exp_salary, na.rm=T), sd(outputs$welfare, na.rm=T)))
results$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
#Put results into table for export - UPDATE - removed " - outside_option" b/c this is done in function above
options(scipen=99)
table <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Contract Value minus Outside Option", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$target, na.rm=T), digits=2)),")"),
round(mean(outputs$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$exp_salary, na.rm=T), digits=2)),")"),
round(1- mean(outputs$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs$ep, na.rm=T), digits=5)),")"),
round(mean(outputs$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$U, na.rm=T), digits=2)),")"),
round(mean(outputs$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$V, na.rm=T), digits=2)),")"),
round(mean(outputs$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$welfare, na.rm=T), digits=2)),")"))
)
View(outputs)
View(table)
#Choose parameters
exp_cost <- 4.9 # in data average is 4.9 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.995 #discount factor
work_cost <- 4.998 #  cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
#Bootstrap results
set.seed(123456)
outputs <- as.data.frame(t(sapply(1:200, boot_opt, treat=0)) )
names(outputs) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income",  "welfare")
results<-data.frame(estimate=c(mean(outputs$target, na.rm=T), mean(outputs$U, na.rm=T), mean(outputs$V, na.rm=T), mean(outputs$ep, na.rm=T), mean(outputs$exp_profit, na.rm=T), mean(outputs$exp_salary, na.rm=T), mean(outputs$welfare, na.rm=T)),
stderr = c(sd(outputs$target, na.rm=T),sd(outputs$U, na.rm=T), sd(outputs$V, na.rm=T), sd(outputs$ep, na.rm=T), sd(outputs$exp_profit, na.rm=T), sd(outputs$exp_salary, na.rm=T), sd(outputs$welfare, na.rm=T)))
results$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
#Put results into table for export - UPDATE - removed " - outside_option" b/c this is done in function above
options(scipen=99)
table <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Contract Value minus Outside Option", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$target, na.rm=T), digits=2)),")"),
round(mean(outputs$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$exp_salary, na.rm=T), digits=2)),")"),
round(1- mean(outputs$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs$ep, na.rm=T), digits=5)),")"),
round(mean(outputs$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$U, na.rm=T), digits=2)),")"),
round(mean(outputs$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$V, na.rm=T), digits=2)),")"),
round(mean(outputs$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs$welfare, na.rm=T), digits=2)),")"))
)
View(table)
########## Estimate treatment outcome when matched only on target
#Change parameters for comparison after monitoring (220 (ish) Ksh drop in repair costs, work time up 10ish percent, so move 1 more work cost given convexity?)
exp_cost <- 2.7 # in data, 490 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.995 #discount factor
work_cost <- 6.088 # cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
set.seed(123456)
outputs2 <- as.data.frame(t(sapply(1:200, boot_opt, treat=1)) )
names(outputs2) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income", "welfare")
results2<-data.frame(estimate=c(mean(outputs2$target, na.rm=T), mean(outputs2$U, na.rm=T), mean(outputs2$V, na.rm=T), mean(outputs2$ep, na.rm=T), mean(outputs2$exp_profit, na.rm=T), mean(outputs2$exp_salary, na.rm=T), mean(outputs2$welfare, na.rm=T)),
stderr = c(sd(outputs2$target, na.rm=T),sd(outputs2$U, na.rm=T), sd(outputs2$V, na.rm=T), sd(outputs2$ep, na.rm=T), sd(outputs2$exp_profit, na.rm=T), sd(outputs2$exp_salary, na.rm=T), sd(outputs2$welfare, na.rm=T)))
results2$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
table2 <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Value", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs2$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$target, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_salary, na.rm=T), digits=2)),")"),
round(1-mean(outputs2$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs2$ep, na.rm=T), digits=4)),")"),
round(mean(outputs2$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$U, na.rm=T), digits=2)),")"),
round(mean(outputs2$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$V, na.rm=T), digits=2)),")"),
round(mean(outputs2$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$welfare, na.rm=T), digits=2)),")"))
)
View(table2)
########## Estimate treatment outcome when matched only on target
#Change parameters for comparison after monitoring (220 (ish) Ksh drop in repair costs, work time up 10ish percent, so move 1 more work cost given convexity?)
exp_cost <- 2.7 # in data, 490 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.99 #discount factor
work_cost <- 6.088 # cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
set.seed(123456)
outputs2 <- as.data.frame(t(sapply(1:200, boot_opt, treat=1)) )
names(outputs2) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income", "welfare")
results2<-data.frame(estimate=c(mean(outputs2$target, na.rm=T), mean(outputs2$U, na.rm=T), mean(outputs2$V, na.rm=T), mean(outputs2$ep, na.rm=T), mean(outputs2$exp_profit, na.rm=T), mean(outputs2$exp_salary, na.rm=T), mean(outputs2$welfare, na.rm=T)),
stderr = c(sd(outputs2$target, na.rm=T),sd(outputs2$U, na.rm=T), sd(outputs2$V, na.rm=T), sd(outputs2$ep, na.rm=T), sd(outputs2$exp_profit, na.rm=T), sd(outputs2$exp_salary, na.rm=T), sd(outputs2$welfare, na.rm=T)))
results2$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
table2 <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Value", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs2$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$target, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_salary, na.rm=T), digits=2)),")"),
round(1-mean(outputs2$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs2$ep, na.rm=T), digits=4)),")"),
round(mean(outputs2$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$U, na.rm=T), digits=2)),")"),
round(mean(outputs2$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$V, na.rm=T), digits=2)),")"),
round(mean(outputs2$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$welfare, na.rm=T), digits=2)),")"))
)
View(table2)
########## Estimate treatment outcome when matched only on target
#Change parameters for comparison after monitoring (220 (ish) Ksh drop in repair costs, work time up 10ish percent, so move 1 more work cost given convexity?)
exp_cost <- 2.7 # in data, 490 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.994 #discount factor
work_cost <- 6.088 # cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
set.seed(123456)
outputs2 <- as.data.frame(t(sapply(1:200, boot_opt, treat=1)) )
names(outputs2) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income", "welfare")
results2<-data.frame(estimate=c(mean(outputs2$target, na.rm=T), mean(outputs2$U, na.rm=T), mean(outputs2$V, na.rm=T), mean(outputs2$ep, na.rm=T), mean(outputs2$exp_profit, na.rm=T), mean(outputs2$exp_salary, na.rm=T), mean(outputs2$welfare, na.rm=T)),
stderr = c(sd(outputs2$target, na.rm=T),sd(outputs2$U, na.rm=T), sd(outputs2$V, na.rm=T), sd(outputs2$ep, na.rm=T), sd(outputs2$exp_profit, na.rm=T), sd(outputs2$exp_salary, na.rm=T), sd(outputs2$welfare, na.rm=T)))
results2$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
table2 <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Value", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs2$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$target, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_salary, na.rm=T), digits=2)),")"),
round(1-mean(outputs2$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs2$ep, na.rm=T), digits=4)),")"),
round(mean(outputs2$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$U, na.rm=T), digits=2)),")"),
round(mean(outputs2$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$V, na.rm=T), digits=2)),")"),
round(mean(outputs2$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$welfare, na.rm=T), digits=2)),")"))
)
View(table2)
View(table)
########## Estimate treatment outcome when matched only on target
#Change parameters for comparison after monitoring (220 (ish) Ksh drop in repair costs, work time up 10ish percent, so move 1 more work cost given convexity?)
exp_cost <- 2.7 # in data, 490 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.994 #discount factor
work_cost <- 6.088 # cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
set.seed(123456)
outputs2 <- as.data.frame(t(sapply(1:200, boot_opt, treat=1)) )
names(outputs2) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income", "welfare")
results2<-data.frame(estimate=c(mean(outputs2$target, na.rm=T), mean(outputs2$U, na.rm=T), mean(outputs2$V, na.rm=T), mean(outputs2$ep, na.rm=T), mean(outputs2$exp_profit, na.rm=T), mean(outputs2$exp_salary, na.rm=T), mean(outputs2$welfare, na.rm=T)),
stderr = c(sd(outputs2$target, na.rm=T),sd(outputs2$U, na.rm=T), sd(outputs2$V, na.rm=T), sd(outputs2$ep, na.rm=T), sd(outputs2$exp_profit, na.rm=T), sd(outputs2$exp_salary, na.rm=T), sd(outputs2$welfare, na.rm=T)))
results2$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
table2 <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Value", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs2$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$target, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_salary, na.rm=T), digits=2)),")"),
round(1-mean(outputs2$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs2$ep, na.rm=T), digits=4)),")"),
round(mean(outputs2$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$U, na.rm=T), digits=2)),")"),
round(mean(outputs2$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$V, na.rm=T), digits=2)),")"),
round(mean(outputs2$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$welfare, na.rm=T), digits=2)),")"))
)
View(table2)
View(table)
View(table2)
########## Estimate treatment outcome when matched only on target
#Change parameters for comparison after monitoring (220 (ish) Ksh drop in repair costs, work time up 10ish percent, so move 1 more work cost given convexity?)
exp_cost <- 2.7 # in data, 490 in control group, expected repairs costs at e* r* which are fixed by mean, std, of Y and independent of T, U
delta <- 0.992 #discount factor
work_cost <- 6.088 # cost of effort + risk for driver which are independent of T, U - note: average G_e seems to be around 250, so seems reasonable that total cost is around that?
days_lost <- 51.437 #rehiring / firing cost for owner - input days lost income equivalent
outside_option <- 0.0725/(1-delta) #"Value of job is 289.59" which should be U minus outside option?
set.seed(123456)
outputs2 <- as.data.frame(t(sapply(1:200, boot_opt, treat=1)) )
names(outputs2) <- c("target", "U", "V", "ep", "exp_profit", "intercept", "exp_salary", "exp_income", "welfare")
results2<-data.frame(estimate=c(mean(outputs2$target, na.rm=T), mean(outputs2$U, na.rm=T), mean(outputs2$V, na.rm=T), mean(outputs2$ep, na.rm=T), mean(outputs2$exp_profit, na.rm=T), mean(outputs2$exp_salary, na.rm=T), mean(outputs2$welfare, na.rm=T)),
stderr = c(sd(outputs2$target, na.rm=T),sd(outputs2$U, na.rm=T), sd(outputs2$V, na.rm=T), sd(outputs2$ep, na.rm=T), sd(outputs2$exp_profit, na.rm=T), sd(outputs2$exp_salary, na.rm=T), sd(outputs2$welfare, na.rm=T)))
results2$names <- c("target", "U", "V","ep","exp_profit", "exp_salary", "welfare")
table2 <- data.frame(Outcome = c("Target", "", "Expected Profit", "","Expected Salary", "", "Prob. Separation", "",
"Driver Value", "", "Owner Value", "",
"Total Welfare", ""),
Prediction=c(round(mean(outputs2$target, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$target, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_profit, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_profit, na.rm=T), digits=2)),")"),
round(mean(outputs2$exp_salary, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$exp_salary, na.rm=T), digits=2)),")"),
round(1-mean(outputs2$ep, na.rm=T), digits=4), paste0("(", as.character(round(sd(1-outputs2$ep, na.rm=T), digits=4)),")"),
round(mean(outputs2$U, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$U, na.rm=T), digits=2)),")"),
round(mean(outputs2$V, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$V, na.rm=T), digits=2)),")"),
round(mean(outputs2$welfare, na.rm=T), digits=2), paste0("(", as.character(round(sd(outputs2$welfare, na.rm=T), digits=2)),")"))
)
View(table2)
rmarkdown::render_site()
setwd("~/Documents/Website/gregorylane.github.io")
rmarkdown::render_site()
